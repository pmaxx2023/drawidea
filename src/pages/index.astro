---
import "../styles/global.css";
// Auth disabled - allowing anonymous usage
---
<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Clario - FHIR Diagrams</title>
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body class="min-h-screen bg-white text-gray-900">
<header class="fixed top-0 left-0 right-0 z-50 bg-white/95 backdrop-blur-sm border-b border-gray-200">
<div class="max-w-6xl mx-auto px-6 py-4 flex items-center justify-between">
<div class="flex items-center gap-3">
<div class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-teal-500 flex items-center justify-center" style="transform:rotate(-3deg)">
<svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
<path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
</svg>
</div>
<span class="text-2xl font-extrabold">Clario</span>
</div>
<nav class="flex items-center gap-6">
<a href="/developers" class="text-gray-600 hover:text-gray-900 transition">Developers</a>
</nav>
</div>
</header>

<section class="pt-32 pb-6 px-6">
<div class="max-w-5xl mx-auto text-center">
<h1 class="text-4xl font-bold mb-4">FHIR diagrams without the pain</h1>
<img src="/hero-before-after.png" alt="Hero" class="w-full rounded-2xl" />
</div>
</section>

<section id="create" class="py-16 px-6 bg-gray-50">
<div class="max-w-3xl mx-auto">
<h2 class="text-2xl font-bold text-center text-gray-900 mb-8">Create Your Clario</h2>
<textarea id="concept" rows="4" placeholder="Describe what you want..." class="w-full bg-white border border-gray-300 rounded-lg p-4 text-gray-900 mb-4"></textarea>
<div class="mb-4">
<label class="block text-gray-400 text-sm mb-2">Visual Style</label>
<select id="style-select" class="w-full bg-white border border-gray-300 rounded-lg p-4 text-gray-900">
<option value="xplane">Whiteboard</option>
<option value="tron">Tron Dark Whiteboard</option>
<option value="fhir-technical">FHIR Technical Diagram</option>
<option value="fhir-workflow">FHIR Workflow</option>
</select>
</div>
<button id="generate-btn" class="w-full bg-blue-600 text-white py-4 rounded-lg font-semibold">Create Clario</button>
<div id="loading-section" class="hidden mt-8">
<div class="bg-gray-50 rounded-xl p-10 text-center border border-gray-200">
<div class="animate-spin w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"></div>
<p id="loading-status" class="text-gray-900 text-lg font-semibold">Generating...</p>
</div>
</div>
<div id="result-section" class="hidden mt-8"><img id="result-image" class="w-full rounded-xl" /><button id="download-btn" class="block w-full mt-4 bg-blue-500 text-white py-4 rounded-xl font-bold">Download</button></div>
<div id="error-section" class="hidden mt-8 text-center text-red-400"><p id="error-message">Error</p><button id="retry-btn" class="mt-2 bg-red-500 text-white py-2 px-4 rounded">Retry</button></div>
</div>
</section>

<script is:inline>
const genBtn = document.getElementById("generate-btn");
const concept = document.getElementById("concept");
const loading = document.getElementById("loading-section");
const result = document.getElementById("result-section");
const errSec = document.getElementById("error-section");
const resImg = document.getElementById("result-image");
const dlBtn = document.getElementById("download-btn");
const errMsg = document.getElementById("error-message");
const retry = document.getElementById("retry-btn");
const styleSelect = document.getElementById("style-select");
let currentImageUrl = null;

async function gen(){
  const c = concept.value.trim();
  if (!c) return alert("Describe something");
  loading.classList.remove("hidden");
  result.classList.add("hidden");
  errSec.classList.add("hidden");
  try {
    const r = await fetch("/api/generate", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ concept: c, style: styleSelect.value })
    });
    const d = await r.json();
    if (!r.ok) throw new Error(d.error || "Generation failed");
    resImg.src = d.imageUrl;
    currentImageUrl = d.imageUrl;
    loading.classList.add("hidden");
    result.classList.remove("hidden");
  } catch (x) {
    loading.classList.add("hidden");
    errMsg.textContent = x.message;
    errSec.classList.remove("hidden");
  }
}

dlBtn.onclick = async () => {
  if (!currentImageUrl) return;
  try {
    const response = await fetch(currentImageUrl);
    const blob = await response.blob();
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "clario-" + Date.now() + ".png";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  } catch (e) {
    window.open(currentImageUrl, "_blank");
  }
};

genBtn.onclick = gen;
retry.onclick = gen;
</script>
</body>
</html>
